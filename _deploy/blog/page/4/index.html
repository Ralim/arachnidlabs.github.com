<!DOCTYPE html>
<html>	
	<head>

		<meta name="description" content="Makers of fine electronics since 2013.">
		<meta http-equiv='Content-Type' content='text/html; charset=utf-8' />
		
		<title></title>

		<link rel="stylesheet" type="text/css" href="/css/style.css">
		<link rel="stylesheet" type="text/css" href="/css/normalize.css">
		<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
		<link rel="stylesheet" type="text/css" href="/css/animate.css">
		<link rel="alternate" type="application/rss+xml" title="Arachnid Labs" href="http://www.arachnidlabs.com/atom.xml" />
	
		<link rel="icon" type="image/png" href="/favicon.png">

		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
		<script type="text/javascript" src="/js/jquery.sticky.js"></script>
		<script type="text/javascript" src="/js/masonry.pkgd.min.js"></script>
		<script type="text/javascript" src="/js/wow.min.js"></script>

		<script>
  			$(document).ready(function(){
    			$("#nav").sticky({topSpacing:0});
  			});
		</script>

		<script type="text/javascript">
			var wow = new WOW(
			  {
			    boxClass:     'wow',      // animated element css class (default is wow)
			    animateClass: 'animated', // animation css class (default is animated)
			    offset:       0,          // distance to the element when triggering the animation (default is 0)
			    mobile:       true,       // trigger animations on mobile devices (default is true)
			    live:         true        // act on asynchronously loaded content (default is true)
			  }
			);
			wow.init();
		</script>

		<!-- If the browser version of IE is less than 9 load HTML5 & CSS3 polyfills -->
        <!--[if lt IE 9]>
            <link rel="stylesheet" href="css/ie.css">
            <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script>
            <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/selectivizr/1.0.2/selectivizr-min.js"></script>
        <![endif]-->

	</head>
	<body>

		<div class="intro">
			
			<div class="center">
				<img src="/images/arachnidlabs.svg">

				<ul class="social">
					<li><a href="https://github.com/arachnidlabs"><i class="fa fa-github"></i></a></li>
					<li><a href="https://twitter.com/arachnidlabs"><i class="fa fa-twitter"></i></a></li>
<!--					<li><a href=""><i class="fa fa-youtube-play"></i></a></li>-->
					<li><a href="https://plus.google.com/+Arachnidlabs/"><i class="fa fa-google-plus"></i></a></li>
				</ul>

			</div>

		</div>

		<div id="nav" class="clearfix">
			
			<div class="wrapper">
				
				<div class="logo">
					
					<h1></h1>

				</div>

				<nav>
					
					<ul class="clearfix">
						<li><a href="/index.html">Home</a></li>
						<li><a href="https://www.tindie.com/stores/arachnidlabs/">Shop</a></li>
						
							
							
							
						
							
							
							
						
							
							
							
						
							
							
							
						
							
							
							
						
							
							
							
						
							
							
							
						
							
							
							
						
							
							
							
								<li><a href="/about/index.html">About</a></li>
							
						
							
							
							
								<li><a href="/labs-cards/index.html">Circuit pattern trading cards</a></li>
							
						
							
							
							
								<li><a href="/reload-2/index.html">Re:load 2</a></li>
							
						
							
							
							
								<li><a href="/reload-pro/index.html">Re:load Pro</a></li>
							
						
							
							
							
						
							
							
							
						
							
							
							
								<li><a href="/minishift/index.html">Minishift</a></li>
							
						
							
							
							
						
							
							
							
						
							
							
							
						
							
							
							
						
							
							
							
						
							
							
							
						
							
							
							
						
							
							
							
						
							
							
							
						
							
							
							
						
							
							
							
						
							
							
							
						
							
							
							
						
							
							
							
						
							
							
							
						
							
							
							
						
							
							
							
						
							
							
							
						
							
							
							
						
					</ul>

				</nav>
				
			</div>

		</div>

		<div class="container">
			



<div class="posts">
	

	<div onclick="window.location.href='/blog/2013/05/27/using-a-solder-paste-dispenser-with-compressed-air-tanks/'" class="mypost wow clearfix ">
	   	<div class="date">
	   		<p class='date-top'>27</p><p class='bottom-date'>May 2013</p>
	   	</div>
	  	<div class="postcontent">
	  		<h1>Using a solder paste dispenser with compressed air tanks</h1>
	    	
    			<p>I recently decided to invest in a Solder Paste Dispenser for the lab. The unit I settled on was the same one as <a href="http://dangerousprototypes.com/forum/viewtopic.php?f=68&amp;t=5121">Dangerous Prototypes bought</a>, the PE-983A. I got mine from <a href="http://www.aliexpress.com/item/Hot-sale-Auto-Glue-Dispenser-Solder-Paste-Liquid-Controller-Dropper-YDL-983A-Dispensing-system/757892187.html">this AliExpress listing</a>.</p>

<p>One thing that’s dissuaded me from buying a solder paste dispenser for so long is that I’m really not keen on a loud and bulky compressor in my workshop area, and I don’t want to spend several times the cost of the dispenser on a small and/or quiet compressor. I’d considered using an airbrush compressor, since they tend to be both quiet and small, but there was scant information on whether or not the smaller working pressure of such a compressor - typically 3 to 4 bar - would be sufficient for solder paste dispensing.</p>

<p>Another idea that occurred to me was using tanks of compressed gas. In theory, they ought to last a very long time, since the dispenser uses very little, and working pressure shouldn’t be an issue. There’s very little information out there on what sort of connection the dispenser uses for compressed air, though, and if you’re new to compressed air fittings like me, there’s a bewildering plethora of options out there. I decided to take the plunge and see what I could figure out anyway, with the help of fellow <a href="http://londonk.hackspace.org.uk/">London Hackspace</a> member artag, to whom I am eternally grateful.</p>

<!-- more -->

<p>After ordering the solder paste dispenser, I picked up <a href="http://www.halfords.com/webapp/wcs/stores/servlet/product_storeId_10001_catalogId_10151_productId_217424_langId_-1_categoryId_255210">this tank of CO2</a>, intended for use as welding gas from Halfords for £16.99, along with <a href="http://www.halfords.com/webapp/wcs/stores/servlet/product_storeId_10001_catalogId_10151_productId_207319_langId_-1_categoryId_255210">this matching regulator</a> for £17.99. It’s not documented there (a common theme with compressed air stuff, it seems), but the regulator has a 4mm pushfit fitting as its output.</p>

<p><img src="https://lh3.googleusercontent.com/q0dNB6oQRioeFE_0rf0aqS4HvBkLovcSPHY1W2B3Ovk=w305-h228-p-no" alt="" /></p>

<p>When the paste dispenser arrived, it turned out to have a 6mm pushfit fitting. (I think this makes me the first person to document this important bit of information anywhere on the web):</p>

<p><img src="https://lh6.googleusercontent.com/JTiTEcLbn1hVAcT0iO4wChQTT2Rir7WqW3AzYlMrueU=w173-h228-p-no" alt="" /></p>

<p>A short trip to EBay later, I had a length of 4mm pushfit tubing, and a 4mm to 6mm pushfit adapter:</p>

<p><img src="https://lh6.googleusercontent.com/3UPUxgQ1bBXfURimvkwULuk-FjyerDa9tq3iogEcUIo=w305-h228-p-no" alt="" /></p>

<p>And we’re all go! Opening the valve, we get about 80PSI, plenty for dispensing solder paste with:</p>

<p><img src="https://lh6.googleusercontent.com/dPY4NTDbKcmyw4vgZAlU2TdddvN1StJCZ2Cfespf8QQ=w306-h228-p-no" alt="" /></p>

<p>Some further notes for those of you thinking of doing the same thing:</p>

<p>First off, the regulator’s 4mm pushfit fitting is in a 1/8” BSP female thread. You could unscrew this and replace it with a 6mm fitting and skip the adapter; I tried this, but the regulator sometimes refuses to dispense gas, and I couldn’t get it working, so I went with the safe option.</p>

<p>Second, I’ve tried closing the regulator a bit to test the dispenser at 40-50PSI, approximately the working pressure of an airbrush compressor. It works absolutely fine, dispensing only a little slower than it does at 80PSI. When this tank runs out, I think I’ll get a cheap compressor instead of a new tank. Airbrush compressors typically have 1/8” male BSP fittings, and you can get adaptors from that to 6mm pushfit on EBay easily. Anyone planning to go the same route should definitely get a compressor with an air tank - that’s pretty much mandatory for this application.</p>

<p>If you try this out yourself - either tank air or the compressor option - I’d love to hear about your experiences.</p>

			
	    	<p class="readmore">
	      		<a href="/blog/2013/05/27/using-a-solder-paste-dispenser-with-compressed-air-tanks/">Read Post</a>
	    	</p>
	  	</div>

	</div>

	

	<div onclick="window.location.href='/blog/2013/05/25/review-headphone-amplifier-kit-from-diyourfaceoff/'" class="mypost wow clearfix ">
	   	<div class="date">
	   		<p class='date-top'>25</p><p class='bottom-date'>May 2013</p>
	   	</div>
	  	<div class="postcontent">
	  		<h1>Review: Headphone Amplifier Kit from diyourfaceoff</h1>
	    	
    			<p>Recently, <a href="https://www.tindie.com/stores/diyourfaceoff/">diyourfaceoff</a>, a fellow Tindie seller, listed a <a href="https://www.tindie.com/products/diyourfaceoff/headphone-amplifier-kit/">headphone amplifier kit</a> on Tindie. As an owner of a moderately nice pair of headphones, I thought it’d be interesting to pick one up.</p>

<p>After pledging, however, and having done a lot more research about headphone amp design, it became apparent that maybe the ultra-simple CMOY design that this kit is based on wasn’t entirely up to scratch. As part of my research, I got turned on to another open source amp design, the <a href="http://nwavguy.blogspot.co.uk/2011/07/o2-headphone-amp.html">Objective2 headphone amplifier</a>. There’s a pile of resources at that link, including design discussions about the O2 design and other common designs like the CMOY - well worth a look. I particularly like NwAvGuy’s emphasis on objective measurements - no fuzzy audiophile nonsense here. While waiting for diyourfaceoff’s kit to arrive, I ordered and built an O2 kit from <a href="http://www.headnhifi.com/o2-kit-full">Head ‘n’ HiFi</a>. When my CMOY kit arrived too, it seemed like it was about time to do a review and comparison.</p>

<!-- more -->

<h1 id="construction">Construction</h1>

<p>First off, impressions of the kit. It arrived in a bubble bag, with most of the components in a ringgrip bag inside. It was satisfactorially packaged, but I was a little unimpressed that everything wasn’t in a single bag - the larger parts were simply loose in the shipment packagaing. A minor issue. Included in the package were all the parts, the PCB - still with mousebite tabs hanging off it - an A4 sheet with a BoM, and a length of solder, which was a nice touch. The volume control is clearly a high quality part, and the battery snap was nice and solid; the headphone jacks seemed a little flimsy.</p>

<p>Assembling the kit is fairly straightforward following the <a href="http://www.diyourfaceoff.com/cmoy">provided build instructions</a>, though I found the suggested assembly order a bit odd and went with my usual practice of starting with the lowest profile parts and working my way up. Another nice touch was the labelling of the resistors: all of them had values written on the paper tape, which saved a significant amount of time. One minor issue is that the holes for the resistors are a little too close for the resistors provided, meaning they tend to stick up a bit off the board.</p>

<p>More significantly, some of the footprints were odd. The film capacitors have polarity indicators marked even though they’re not polar; the electrolytics had footprints marked as long oblongs instead of round, and the footprint for the LED shows a flat but no anode indicator, while the provided LED lacks a flat on one side.</p>

<p>For practical use, I forsee a significant problem: there’s no enclosure, nor does the PCB appear to be designed to fit in a standard one. Having a bare circuit board on one’s desk seems less than ideal.</p>

<h1 id="design">Design</h1>

<p>Sadly, diyourfaceoff hasn’t published the schematics or design files for his implementation of the CMOY design - a significant omission given the open source nature of the design. There are a lot of CMOY variants out there, too. Looking at the components, however, we can learn something about the design.</p>

<p>First off, there’s no evidence of a dedicated rail splitter of any sort, and the 2 channel opamp is entirely occupied with processing the 2 channel audio. With no bipolar power supply, a virtual ground is mandatory for an amp like this - how is it being generated? A little Googling on CMOY designs and some examination of the PCB reveals it: Using a resistive divider! Two 4.7k resistors between 9v and ground create a virtual ground reference point, which is buffered with large 220uF electrolytic capacitors. This is, to say the least, far from ideal. Any current through ground will tend to push the voltage away from 1/2 the battery voltage, and this will have a number of negative effects on the amp, as we’ll soon see.</p>

<h1 id="testing">Testing</h1>

<p>First off, basic tests. You’ll be pleased to know neither amp will destroy your headphones: both have negligible DC bias on their outputs.</p>

<p>My approach for more sophisticated testing was simple: Connect both amps to a signal source - in this case, my phone running a tone generator - run them on battery power, and use my oscilloscope to measure the input and output signals at a number of frequencies and with both sine and square waves. I started off with the O2 amp; here it is handling a 900hz sine wave:</p>

<p><img src="http://i.imgur.com/owiLZQF.png" alt="" /></p>

<p>In all these images, the top signal is the output waveform, the bottom signal is the input waveform, and the middle signal is the arithmetic difference between the two. In all cases the volume has been adjusted for unity gain, so ideally the middle signal should be effectively flat at 0. As you can see, my test signal isn’t entirely clean, but it ought to suffice for the test. Here, the O2 amp is faithfully reproducing the input, and only some low level noise shows up on the difference.</p>

<p>Here’s the O2 handling 300hz and 100hz sine waves, respectively:</p>

<p><img src="http://i.imgur.com/FD5e6Ox.png" alt="" /> <img src="http://i.imgur.com/0nug4Sb.png" alt="" /></p>

<p>Again, it does a champion job, faithfully reproducing the input waveforms. Square waves are a little trickier, but it manages those too:</p>

<p><img src="http://i.imgur.com/jNhsGHD.png" alt="" /> <img src="http://i.imgur.com/UWRI2Pv.png" alt="" /> <img src="http://i.imgur.com/aW4ly7T.png" alt="" /></p>

<p>Depicted above are 900hz, 300hz and 100hz square waves, respectively. Again, the input is more or less indistinguishable from the output.</p>

<p>Let’s try out the CMOY design. I’ve already predicted the poor virtual ground will introduce issues; am I right?</p>

<p><img src="http://i.imgur.com/OXSGF5m.png" alt="" /></p>

<p>That’s the CMOY handling a 900hz sine wave. It’s fairly faithful, but notice a little bit of ripple in the output waveform. Let’s see how it handles lower frequencies, 300hz and 100hz:</p>

<p><img src="http://i.imgur.com/LHDDXpR.png" alt="" /> <img src="http://i.imgur.com/felQJkf.png" alt="" /></p>

<p>Hm, that difference signal is getting significantly bigger. As predicted, the problem here is the virtual ground: lower frequency signals are slow enough to significantly charge or discharge the capacitors creating the reference voltage, and that introduces phase shift in the output signal. The lower the frequency, the worse the effect.</p>

<p>If that’s right, then this problem should be much more noticeable with a square wave signal, and indeed it is. Here’s the CMOY handling 900hz, 300hz and 100hz square waves:</p>

<p><img src="http://i.imgur.com/rEX8o9J.png" alt="" /> <img src="http://i.imgur.com/JGEgYhu.png" alt="" /> <img src="http://i.imgur.com/UWUyooX.png" alt="" /></p>

<p>By the time we get down to 100hz, the effects are impossible to ignore. Our square waves no longer look very square - they’re well on their way to being triangle waves! This effect gets worse with volume, of course - the higher you turn up the volume, the more power flows through the virtual ground, and the larger the deviation induced.</p>

<h1 id="conclusion">Conclusion</h1>

<p>While a simple it, and reasonably well presented, diyourfaceoff’s headphone amplifier has a few issues - and one fatal flaw. While it uses a high quality opamp, that becomes a moot point due to the poor design of its power supply. Unfortunately, I can’t recommend it to anyone as an amplifier solution - you’d be better off plugging your headphones in direct, or splashing out a bit more and getting the O2.</p>

<p>I also feel like the lack of schematics and design files are worth a mention. The CMOY design on which the amp is based on is open source; it would be only fair to release the design files likewise.</p>

			
	    	<p class="readmore">
	      		<a href="/blog/2013/05/25/review-headphone-amplifier-kit-from-diyourfaceoff/">Read Post</a>
	    	</p>
	  	</div>

	</div>

	

	<div onclick="window.location.href='/blog/2013/05/23/the-psoc-4-pioneer-and-the-loki/'" class="mypost wow clearfix ">
	   	<div class="date">
	   		<p class='date-top'>23</p><p class='bottom-date'>May 2013</p>
	   	</div>
	  	<div class="postcontent">
	  		<h1>The PSoC 4 Pioneer and the Loki</h1>
	    	
    			<p>Recently, Cypress released a new range of processors, the <a href="http://www.cypress.com/?id=4749">PSoC 4</a>, and a new development kit for them, the <a href="http://www.cypress.com/?rID=77780">Pioneer</a>. The PSoC 4 is Cypress’s new line of low power configurable microprocessors. They’re based on the Arm Cortex M0 architecture, and have much more basic analog and digital capabilities than the 3 and 5, but still retain the PSoC’s incredible reconfigurability. The pioneer is an Arduino clone based on the PSoC 4 processor; it’s got onboard program and debug capabilities using an onboard PSoC 5(!) configured for interactive debugging. The whole board sells for $30 US.</p>

<p>A lot of people have been asking me about the Loki and my plans for it, especially in view of the release of the Pioneer. This is something I’ve been giving a lot of thought to. The Pioneer has a lot of advantages - it’s made by Cypress, it’s at a price point I can’t match with the Loki, and it has onboard debugging, something I wasn’t able to build into the Loki at a reasonable price. Whilst the Pioneer lacks Loki’s very cool and flexible expansion system, it’s able to take advantage of the entire ecosystem of existing Arduino shields out there.</p>

<p>Loki could still have a very viable niche as a ‘big brother’ to the Pioneer, since the PSoC 5 is so much more capable than the 4. I’m considering releasing it with this in mind - possibly redesigned to fit an Arduino Mega / Due form factor to take best advantage of the Arduino ecosystem and to provide a simple upgrade path. Sadly, this would mean giving up on the Loki’s expansion system and the flexibility that grants.</p>

<p>In the short term, however, I’ve decided to put Loki on hold while I see how the Pioneer pans out, and to give me time to work on other projects. Keep an eye out for more progress in a little while. In the meantime, though, I do have another very cool project that uses the PSoC 5 in the pipeline - expect an announcement on that in the next few days!</p>

			
	    	<p class="readmore">
	      		<a href="/blog/2013/05/23/the-psoc-4-pioneer-and-the-loki/">Read Post</a>
	    	</p>
	  	</div>

	</div>

	

	<div onclick="window.location.href='/blog/2013/04/29/labs-update/'" class="mypost wow clearfix ">
	   	<div class="date">
	   		<p class='date-top'>29</p><p class='bottom-date'>Apr 2013</p>
	   	</div>
	  	<div class="postcontent">
	  		<h1>Labs Update</h1>
	    	
    			<p>Remik sent in photos of an awesome Re:load casemod he put together:</p>

<p><img src="https://lh4.googleusercontent.com/-w44uzHJpJjY/UX7a2toj-1I/AAAAAAAADoQ/qlQLEQE9_Q8/w378-h580/cSAM_4227.JPG" width="300" />
<img src="https://lh6.googleusercontent.com/-iv7g-4-rOCY/UX7a_5ZOkGI/AAAAAAAADoo/rM6nNnxeoPQ/w444-h580/cSAM_4233.JPG" width="300" />
<img src="https://lh4.googleusercontent.com/-ZvS1AGKDqoM/UX7bHiErgcI/AAAAAAAADo8/JNmyGG9A3w0/w500-h428-p-o/cSAM_4236.JPG" width="300" /></p>

<p>He says:</p>

<blockquote>Yes - that is/was standard case made, I think, by Hammond. [...]
I attach few photos - I didn't disassembled re:load completely - I don't want to destroy top panel.
This one is simply print out on adhesive paper + scotch transparent tape on top.
Panel has been designed in Front Panel Designer.</blockquote>

<p>The case has main terminals on the top for the load, as well as a secondary set of terminals on the front that are hooked up to the sense terminals.</p>

<p>Got your own casemod for the Re:load? Send it in and I’ll show it off!</p>

<p>Also, the stencil8 tooling blocks are back in stock, now with a new design:</p>

<p><img src="https://lh4.googleusercontent.com/-pha74dhc9_o/UX7aw9gOM1I/AAAAAAAADoE/agN1qV59kis/w685-h428-p-o/P1010309.JPG" width="400" /></p>

<p>I’m really happy with these tooling blocks. The tooling quality is top notch; all the holes are chamfered, and so are the edges of the block. It’s even got a logo:</p>

<p><img src="https://lh5.googleusercontent.com/-omLPh3oF4iQ/UX7au0-Tw8I/AAAAAAAADn8/oYzJ_k_MqBg/w686-h428-p-o/P1010307.JPG" width="400" /></p>

<p>I’ve also found a better way to package the blocks, using cardboard book sleeves, like those used by Amazon. They’re lightweight and they make sure your tooling block gets to you in mint condition.</p>

<p>If you’d like one, you can get your own <a href="https://www.tindie.com/products/arachnidlabs/pcb-fixture-block-for-solder-paste-stencilling/">here</a>.</p>

			
	    	<p class="readmore">
	      		<a href="/blog/2013/04/29/labs-update/">Read Post</a>
	    	</p>
	  	</div>

	</div>

	

	<div onclick="window.location.href='/blog/2013/04/11/quick-fix-for-re-load-oscillations/'" class="mypost wow clearfix ">
	   	<div class="date">
	   		<p class='date-top'>11</p><p class='bottom-date'>Apr 2013</p>
	   	</div>
	  	<div class="postcontent">
	  		<h1>Quick fix for Re:load oscillations</h1>
	    	
    			<p>I’ve discovered a situation in which Re:load (both regular and epic) can generate ripple on the Device Under Test. This is only of concern to users who are using the Re:load to characterize power supplies - it won’t affect you if you are generating a load for other purposes such as testing a device’s output capability - and only occurs at voltages between 3 and 5 volts and currents over 1 amp.</p>

<p>Fortunately, this is easily remedied. Here’s the procedure:</p>

<ol>
  <li>Cut pin 2 of the MCP6002 opamp IC.</li>
  <li>Attach a 10k resistor between pin 2 of the MCP6002 opamp and the left hand leg of the 0.05 ohm shunt resistor.</li>
  <li>Attach a capacitor of between 10nF and 100nF (0.1uF) between legs 1 and 2 of the opamp.</li>
</ol>

<p>Here’s a photo of the completed modification:</p>

<p><img src="https://lh5.googleusercontent.com/-j6B16yiQQWs/UWcgDNHhqtI/AAAAAAAADmc/C1PGuPOen5c/w584-h437-p-o/IMG_20130411_212436.jpg" /></p>

<p>If you think this issue might affect you and you’re not confident in making the modification yourself, please email me at <a href="mailto:nick@arachnidlabs.com">nick@arachnidlabs.com</a>, and we can arrange for return shipping, and I will perform the modification for you.</p>

<p>Version 2 of the Re:load, which I’m currently designing, will include the modification, as well as having several other improvements, such as a lower minimum voltage and a higher maximum voltage.</p>

			
	    	<p class="readmore">
	      		<a href="/blog/2013/04/11/quick-fix-for-re-load-oscillations/">Read Post</a>
	    	</p>
	  	</div>

	</div>

	

	<div onclick="window.location.href='/blog/2013/04/05/inside-minimatrix/'" class="mypost wow clearfix ">
	   	<div class="date">
	   		<p class='date-top'>5</p><p class='bottom-date'>Apr 2013</p>
	   	</div>
	  	<div class="postcontent">
	  		<h1>Inside Minimatrix</h1>
	    	
    			<p>While <a href="http://www.arachnidlabs.com/minimatrix/">minimatrix</a> is in principle a pretty simple device, there’s a surprising amount of detail that goes into getting it right - and some interesting lessons to be learned in designing and programming it. I thought I’d detail a few of them for the benefit of anyone building something similar - or simply for interest.</p>

<p><img src="https://lh5.googleusercontent.com/-dIEs_QLdqoM/UV07YOZDV4I/AAAAAAAADkE/AfhDFCBIMdM/w524-h392-p-o/P1010286.JPG" /></p>

<h1 id="minimatrix-schematic">Minimatrix schematic</h1>
<p>Here’s the complete minimatrix schematic:</p>

<p><a href="https://github.com/arachnidlabs/minimatrix/blob/master/schematics/minimatrix-schematic.png?raw=true"><img src="https://github.com/arachnidlabs/minimatrix/blob/master/schematics/minimatrix-schematic.png?raw=true" width="800" /></a></p>

<p>As you can see, it’s fairly straightforward. The LED matrix is driven directly by the attiny; other than that we only have the IR receiver and button - which use the same GPIO pin - and the battery. The microcontroller is an ATTiny4313, which has - just barely - enough GPIO pins to drive the matrix.</p>

<p>There’s good reasons for assigning the pins the way they are here - and we’ll get into them a bit more in the section on driving the matrix, below.</p>

<h1 id="pcb-layout">PCB Layout</h1>

<p>PCB layout is also fairly simple, though we have a serious lack of space on something so small. A double sided approach is necessary, and has the added advantage of looking awesome.</p>

<p><img src="https://raw.github.com/arachnidlabs/minimatrix/master/schematics/minimatrix-layout.png" /></p>

<p>The back of the board - the part that faces out when soldered to a matrix - has all thru-hole parts: the battery holder, IR receiver, and button. The front of the board is all surface mount, and has the microcontroller, resistor arrays, and a couple of decoupling capacitors. The nice thing about this is that once everything’s soldered together, the microcontroller is entirely hidden from view - all you see is a neatly packaged device with battery, button, and display.</p>

<h1 id="led-matrixes">LED Matrixes</h1>
<p>There’s a lot of choice out there when it comes to picking LED matrixes, and unfortunately the choice doesn’t stop at form factor and capabilities. There’s absolutely no standard pinout for LED matrices, and few if any of the pinouts make any logical sense, either. Here’s a couple:</p>

<p><img src="http://i.imgur.com/gWaxIEI.jpg" /> <img src="http://i.imgur.com/Jmj8zhE.jpg" /></p>

<p>While the first one makes marginally more sense, neither is what I’d call a logical arrangement of pins. Fortunately minimatrix only has to care about monocolor LED matrixes, because when you get to bicolor and full color ones, the number of available pinouts explodes exponentially.</p>

<p>Single color LED matrixes come in what is commonly referred to as “common anode” and “common cathode” versions. In a single-color matrix, this notation doesn’t make a lot of sense, so it’s easier to think of it by considering whether rows are anodes or cathodes. It’s unimportant which you choose for a single color matrix, but for multi-color ones, common anode is often easier, since it’s easier to do high powered low-side switching than it is to do high-side switching.</p>

<h1 id="driving-the-matrix">Driving the matrix</h1>
<p>The basic approach to driving an LED matrix like this is well known and not terribly complicated. You scan over rows, and for each one you power the appropriate columns that should be lit for that row, sourcing your data from some sort of frame buffer. This is most easily done inside a timer interrupt; realistically in order to get a nice flicker free display you need to scan the rows around 50 times a second or more; I went with 100, meaning your timer interrupt needs to fire 800 times a second to scan all the rows. Not terribly difficult, even for a low powered MCU like the ATTiny range.</p>

<p>One significant refinement is in the way pins are allocated, as I alluded to above. Note from the schematic that all the columns are driven - in order - from a single port, port B. This is the only port on the ATTiny4313 that has a full 8 pins. Doing things this way has a major advantage when it comes to the speed and efficiency of our code to write data to the display. Instead of having to individually set each bit, we can write an entire column with a single operation by copying straight from our frame buffer to the port. Here’s the core of our timer interrupt routine:</p>

<pre><code>ISR(TIMER0_COMPA_vect) {
	static uint8_t row = 0;

	// Turn off the old row
	PORTD |= PORTD_ROWS;
	PORTA |= PORTA_ROWS;

	// Set the column data
	row = (row + 1) &amp; 0x7;
	PORTB = display[row];

	// Turn on the new row
	ENABLE_ROW(row);
}
</code></pre>

<p>As you can see, this is extremely straightforward, and quick to execute. All we do is set the appropriate row bit, increment the row counter, and output the data for that row to port B.</p>

<p>Done? Not quite. Check out this photograph of the minimatrix in action:</p>

<p><img src="https://lh5.googleusercontent.com/-umbJ_A5Xux0/UV7GyT9xJJI/AAAAAAAADko/JCUEAkR0TPs/w631-h391-p-o/IMG_20130405_131821.jpg" /></p>

<p>Notice how the columns with fewer LEDs on are brighter than the columns with more? That shouldn’t be the case, and at first glance it’s not obvious why it would happen. Check out this chart from the datasheet, though:</p>

<p><img src="http://i.imgur.com/qPRT6AZ.png" width="800" /></p>

<p>That’s showing the voltage on a pin that’s being pulled low, relative to the amount of current it’s sinking. As you can see, the more current it’s sinking, the higher the voltage - consistent with the pin having a nonzero resistance to ground. If we’re sinking 10 milliamps at room temperature, the voltage on the pin will be about 0.3 volts. Since our supply voltage is only 3 volts, and the forward voltage drop on our LEDs is about 2 volts, that means our LED just got about 30% dimmer!</p>

<p>The solution to this is reasonably straightforward. Instead of setting a single timer interrupt for display refresh, we set two. The first turns the LEDs on as above. Then, it calculates a delay based on the number of lit LEDs in the column, and sets the delay until the second timer interrupt accordingly. This second timer interrupt turns the LEDs off - effectively, dimming the display so that all rows are the same brightness as one with all its LEDs lit. This is perhaps the only practical use I’ve ever encountered for all those <a href="http://graphics.stanford.edu/~seander/bithacks.html#CountBitsSetNaive">bit manipulation hacks for counting set bits</a></p>

<h1 id="programming">Programming</h1>
<p>Before settling on IR, I experimented with a couple of options for allowing users to program messages and animations into the minimatrix. One I spent a lot of time on was programming using computer monitors and light detectors, like <a href="http://hackaday.com/2013/02/25/using-a-flashing-lcd-monitor-to-transfer-data/">these</a> <a href="http://hackaday.com/2011/07/28/microcontroller-communications-using-flashing-lights/">projects</a> <a href="http://hackaday.com/2012/05/08/light-programming-for-a-clock/">did</a>. It’s not even necessary to add light sensors, since the LED matrix can be used for that purpose.</p>

<p>Sensing light using an LED is pretty simple. Reverse bias the LED - set the cathode high and the anode low - then stop driving one of them and wait to see how long it takes it to change state. The more light is shining on the LED, the faster the anode will go high (or the cathode, low). If all you care about is a digital threshold, you can pick a delay that distinguishes the two light levels you care about, wait that long, and then do a single check.</p>

<p>In principle, the LED matrix can be used the same way. It even ought to be possible to have an entire matrix of sensors, by selectively reverse biasing rows and then testing columns, or vice versa. In practice, I had a lot of issues with this causing what appeared to be crosstalk - both electrical and optical - between rows and columns. I was able to use entire rows as a single sensor with some degree of reliability, but that was about it.</p>

<p>A further problem with this approach is speed. For light levels emitted by a typical computer monitor, you need to wait between about 5 and 20 milliseconds for each sense, which gives you a realistic upper bitrate of about 50 bits per second - less than spectacular. You can attempt to use multiple channels, but then you run into the crosstalk issues I alluded to above.</p>

<p>Given the low bitrate, reliability, and crosstalk issues, I decided to move on. Fortunately, IR is a whole different ballgame.</p>

<h1 id="ir-decoding">IR decoding</h1>
<p>There’s a number of IR encoding schemes for remote controls out there. Some of the more popular ones are <a href="http://www.sbprojects.com/knowledge/ir/rc5.php">RC-5</a>, <a href="http://www.sbprojects.com/knowledge/ir/nec.php">NEC</a> and <a href="http://www.sbprojects.com/knowledge/ir/sirc.php">Sony SIRC</a>. All of them use on-off keying with a carrier wave in the range of 36-40KHz - most commonly 38KHz. What this means is that they emit a series of pulses at 38KHz for ‘on’, and no pulses for ‘off’. This is easily detected and decoded by common IR receiver components, so the signal the microcontroller gets is a logic low when a carrier wave is present, and a logic high when it isn’t.</p>

<p>The protocol used by the remote controls I’m using, and the one I decided to go with, is RC-5. This is a fairly straightforward protocol. Each message is 14 bits long, consisting of a start bit, a ‘field’ bit, a ‘toggle’ bit, a 5 bit device address, and a 6 bit command. There’s no checksumming or error correction.</p>

<p>All of this data is transmitted using manchester encoding. Manchester encoding works by splitting each bit up into two half-bits. A 0 is represented by the sequence 10, while a 1 is represented by the sequence 01. The purpose of this is to ensure regular transitions in the data stream, which makes it practical for the receiver and transmitter to stay in sync with each other.</p>

<p><img src="http://i.imgur.com/jzH3Jh0.gif" /></p>

<p>While manchester encoding’s very simple in principle, figuring out the best way to decode it took me an embarrassingly long time. Using an interrupt or polling based system, each time the signal goes from 1 to 0 or 0 to 1, you know how long it’s been since the last transition - but how do you extract the datastream from that? I’d recommend stopping and thinking about the problem before you read on - see if you arrive at the same solution I did!</p>

<p>Ready? Okay.</p>

<p>The important insight with manchester encoding is that there is a transition in the middle of every bit. If the transition is high to low, the bit being transmitted is a 0, if the transition is low to high, the bit being transmitted is a 1. All we have to do now is identify which transitions are in the middle of bits (the ones we care about) and which are between bits (which we can discard).</p>

<p>Fortunately, this is really easy to do. Since we’re already timing the interval since the last transition, simply check that when we get a transition. If it’s about half a bit interval - 889 microseconds in the case of RC5 - ignore the transition, and keep counting, since we know it’s an inter-bit transition. Any other transitions are logically those corresponding to bits, and we simply observe the direction of the transition to decode the data. Simple!</p>

<p>In the current minimatrix firmware, this is done with a timer interrupt, but with the new schematic and PCB, this can be done with an interrupt - which has the additional benefit of making it possible to wake the minimatrix up from power down mode with IR commands.</p>

<h1 id="text">Text</h1>
<p>Another challenge in building LED matrix displays is how to display text. Typically a bitmap font is used for this, with a common size being 7x5 pixels. The font can be stored as constant data in a C file and compiled straight into the firmware. There aren’t a great deal of good options out there, and the best one I found is <a href="https://github.com/adafruit/Adafruit-GFX-Library/blob/master/glcdfont.c">Adafruit’s glcdfont</a>. This is a 7x5 bitmap font, represented as 5 bytes for each glyph; each byte corresponds to a column, which lines up very conveniently with minimatrix’s column addressing. Thus, when handling text, each time we need to scroll a new column into view, we look up the relevant column of the current glyph in the font array, and simply write that byte to the frame buffer. Simple, and quick.</p>

<p>Currently, minimatrix embeds the entire glcdfont in firmware, all 256 glyphs. This uses up a fair chunk of flash - 1280 bytes out of the 4k available - so it’s distinctly possible that it’ll be cut down to just the 128 or even 96 most useful glyphs in future, as we try to cram more features in.</p>

<p>Another alternative is a proportional font, which has a couple of advantages. It looks substantially nicer, since ‘i’ and ‘l’ and so forth no longer take up the same with as ‘m’ and ‘w’. It also allows for having ‘dingbat’ or ‘icon’ glyphs in the font which are wider than a typical glyph, up to the full 8 columns. There’s two main disadvantages: First, it will require more memory, not less, to store the indexing information required to look up variable width characters. Second, I haven’t been able to find any variable width bitmap fonts! This is why one of the stretch goals for the minimatrix fundraiser is to commission such a font, and open-source it, which I believe will be a benefit to anyone wanting to do this sort of text display.</p>

<p>Also, if anyone has any ingenious ideas on how to represent a proportional font in as little memory as possible, I’d be very keen to hear them.</p>

<h1 id="storing-and-displaying-animations">Storing and displaying animations</h1>
<p>Minimatrix’s approach to storing and displaying data is straightforward. Text and animations are stored in EEPROM, of which the 4313 has 256 bytes. The first few bytes are a header, specifying what type of data it is, and other important information, like the scroll speed or frame rate, and the number of frames in the case of animations. 256 bytes is enough for about 248 characters of text data, or 31 frames of (uncompressed) animation.</p>

<p>Currently, minimatrix has two graphics and storage modes: marquee text, and raw framebuffer animation. A tool is provided in the github repository to convert 8x8 2 bit gifs into the format used for animation. I’d like to implement more graphics modes, and contributions from others along these lines are very welcome.</p>

<h1 id="contribute-and-get-a-free-minimatrix">Contribute and get a free minimatrix</h1>
<p>I’d very much like to see contributions from others to the minimatrix firmware. Send a pull request to <a href="http://github.com/arachnidlabs/minimatrix/">the github repository</a> with a feature, bugfix or enhancement, and I’ll send you a free one in the mail. Easy!</p>

<h1 id="oshw">OSHW</h1>
<p>Of course, Minimatrix is open source hardware, and the firmware is open source too. Check it out in <a href="http://github.com/arachnidlabs/minimatrix/">the github repository</a>.</p>

<h1 id="get-one">Get one</h1>
<p>I’m currently running a <a href="https://tindie.com/products/arachnidlabs/minimatrix/">fundraiser for minimatrix on Tindie</a>, and you can get one for just $12.50 with an IR remote, or $10 without. The LED matrix manufacturer has a high minimum order quantity, so I’m hoping there’s enough interest to justify doing a run of them.</p>

			
	    	<p class="readmore">
	      		<a href="/blog/2013/04/05/inside-minimatrix/">Read Post</a>
	    	</p>
	  	</div>

	</div>

	

	<div onclick="window.location.href='/blog/2013/04/03/minimatrix-now-available/'" class="mypost wow clearfix ">
	   	<div class="date">
	   		<p class='date-top'>3</p><p class='bottom-date'>Apr 2013</p>
	   	</div>
	  	<div class="postcontent">
	  		<h1>Minimatrix now available</h1>
	    	
    			<p>I’m happy to announce that Minimatrix is finally ready to go!</p>

<p><a href="https://plus.google.com/photos/116127381267973124425/albums/5862907550609543601"><img src="https://lh5.googleusercontent.com/-dIEs_QLdqoM/UV07YOZDV4I/AAAAAAAADkE/AfhDFCBIMdM/w491-h368-p-o-k/P1010286.JPG" /></a></p>

<iframe width="560" height="315" src="http://www.youtube.com/embed/QNA6DSa0spc" frameborder="0" allowfullscreen=""></iframe>

<p>Minimatrix is a tiny (3cm x 3cm) battery powered LED matrix display, reprogrammable over infra-red. It displays marquee text and short animations, which can be programmed using an infrared remote control or from a computer via an Arduino or similar development platform. You can even use it as an interactive display by updating it live!</p>

<p>Minimatrix is based around a small single-color LED matrix and an ATTiny4313 microcontroller. It’s powered by a single coin cell battery, which will last for 12-24 hours of continuous operation and months on standby. An IR receiver allows it to receive instructions and data from other embedded devices and standard IR remote controls.</p>

<p>If you’d like a Minimatrix, you can get one for just $12.50 including an IR remote control <a href="https://tindie.com/products/arachnidlabs/minimatrix/">on Tindie</a> - or use the coupon code NOREMOTE to get the minimatrix on its own for just $10.</p>

<p>Like all my stuff, minimatrix is open source hardware, and the firmware is open source too. You can check out the source files for both on github <a href="http://github.com/arachnidlabs/minimatrix/">here</a>.</p>

			
	    	<p class="readmore">
	      		<a href="/blog/2013/04/03/minimatrix-now-available/">Read Post</a>
	    	</p>
	  	</div>

	</div>

	

	<div onclick="window.location.href='/blog/2013/03/25/re-load-build-pictures/'" class="mypost wow clearfix ">
	   	<div class="date">
	   		<p class='date-top'>25</p><p class='bottom-date'>Mar 2013</p>
	   	</div>
	  	<div class="postcontent">
	  		<h1>Re:load build pictures</h1>
	    	
    			<p><a href="http://talsit.org">Talsit</a> built his Re:loads, with a couple of modifications:</p>

<p><img src="https://lh5.googleusercontent.com/-u-29xWg1P5I/UVDXBIqA26I/AAAAAAAAAEU/VyI1ILMlXsw/w675-h683-p-o-k/reload%2Bbuild.jpeg" /></p>

<p>He says:</p>

<blockquote>I got the knobs at kyoritsu, my "local" electronics shop, at Den Den Town here in Osaka. As for banana pagando plugs, I'm using the female end of the LiPo battery connectors from hobbyking - I have a whole bunch of them an they fit.

And I've been doing more tests on my psu front end and this thing is proving so handy!</blockquote>

<p>I love the build - and the presentation is brilliant too.</p>

<p>Have you hacked the Re:load in some fashion? Drop me <a href="mailto:nick@arachnidlabs.com">an email</a> and let me know.</p>


			
	    	<p class="readmore">
	      		<a href="/blog/2013/03/25/re-load-build-pictures/">Read Post</a>
	    	</p>
	  	</div>

	</div>

	

	<div onclick="window.location.href='/blog/2013/03/15/introducing-minimatrix/'" class="mypost wow clearfix ">
	   	<div class="date">
	   		<p class='date-top'>15</p><p class='bottom-date'>Mar 2013</p>
	   	</div>
	  	<div class="postcontent">
	  		<h1>Introducing minimatrix</h1>
	    	
    			<p>Time to unveil Arachnid Labs next project, Minimatrix!</p>

<p><img src="https://lh5.googleusercontent.com/-1WszGdAksoI/UTEsFVqaW9I/AAAAAAAAC3w/CdYmlgQo7LA/w675-h683-p-o-k/IMG_20130301_200529.jpg" width="300" />
<img src="https://lh3.googleusercontent.com/-NlM9cbr1AOI/UTEsFUQ0XoI/AAAAAAAAC74/U723gfx8k-0/s680/IMG_20130301_200538.jpg" width="300" /></p>

<p>Minimatrix is a tiny (3cm x 3cm) battery powered LED matrix display,
reprogrammable over infra-red. It displays marquee text and short
animations, which can be programmed using an infrared remote control
or from a computer via an Arduino or similar development platform. You
can even use it as an interactive display by updating it live!</p>

<iframe width="560" height="315" src="http://www.youtube.com/embed/QNA6DSa0spc" frameborder="0" allowfullscreen=""></iframe>

<p>Minimatrix is based around a small single-color LED matrix and an ATTiny4313
microcontroller. It’s powered by a single coin cell battery, which will
last for 12-24 hours of continuous operation and months on standby. An IR
receiver allows it to receive instructions and data from other embedded
devices and standard IR remote controls.</p>

<p>Minimatrix will sell for $10 as a simple kit with only the SMD parts soldered,
or for slightly more fully assembled. It’s not available quite yet, but
will be very soon!</p>

			
	    	<p class="readmore">
	      		<a href="/blog/2013/03/15/introducing-minimatrix/">Read Post</a>
	    	</p>
	  	</div>

	</div>

	

	<div onclick="window.location.href='/blog/2013/02/26/labs-update/'" class="mypost wow clearfix ">
	   	<div class="date">
	   		<p class='date-top'>26</p><p class='bottom-date'>Feb 2013</p>
	   	</div>
	  	<div class="postcontent">
	  		<h1>Labs update</h1>
	    	
    			<p>Busy week this week, but little progress on things that seem important.</p>

<p>I bought a label printer to simplify the process of shipping out orders. Combined with Tindie’s new CSV export option, I can now take a bunch of orders and automatically generate and print labels; the labels have a datamatrix in the corner that when scanned with my phone sends my browser to the relevant order page, so I can see what to pack and click ‘shipped’ when I’m done. Automation!</p>

<p>Incidentally, the label printer, a Brother QL-700, turns out to be really excellent. It uses label rolls in simple plastic caddies, which when inserted identify themselves to the printer by a simple punched-hole-and-switch system. Threading the labels into the printer is simplicity itself, making changing label types really easy. On top of that, it shows up as a standard printer. It also exposes a USB drive with a ‘lite’ version of their software, or you can download a much more capable package from Brother’s site. To my great surprise, the label software is actually pretty decent, with sophisticated layout and mail-merge options built right in. The only major problem I’ve been able to identify so far is poor unicode support. I wrote a simple Python script to read and munge Tindie’s CSV files into a format more suitable for a mail merge.</p>

<p>All the parts for the Re:load have arrived by now barring the PCBs and some extra thermal paste for the unexpected surge in orders. Both have shipped from China, and should be with me soon; once they arrive I can start shipping, at which point all my automation becomes truly useful. I spent a few hours on the weekend and Monday packing kits; I think it takes me a little over 1 minute per kit all up, including sticking labels and packing the bags with parts. I’ve done 100, and will do the rest soon. It’s curiously calming, though also prone to giving one RSI.</p>

<p>I continue to fight with the CNC shop to get the rest of the tooling blocks done. They swear they’ll call me tomorrow with good news. Fingers crossed.</p>

<p>I finally plugged in the Loki Sound Plank and gave it a simple test run. As hoped, it works perfectly, at least the bits I’ve tested so far. Ideas for a sample that shows it off are appreciated.</p>

			
	    	<p class="readmore">
	      		<a href="/blog/2013/02/26/labs-update/">Read Post</a>
	    	</p>
	  	</div>

	</div>

	
</div>
</div>

	<div class="pagination">
		<div class="innerpagi clearfix">
		  	
		    	<a class="previous" href="/blog/page/3">&laquo; Previous</a>
		  	

		  	
		    	<a class="next" href="/blog/page/5">Next &raquo;</a>
		  	
		</div>
	</div>



		</div>

		<footer class="clearfix">
			<p>2014 &copy Arachnid Labs | Theme designed by <a href="http://www.themeforest.net/user/uziiuzair">Uzair Hayat</a></p>

			<ul class="social">
				<li><a href="https://github.com/arachnidlabs"><i class="fa fa-github"></i></a></li>
				<li><a href="https://twitter.com/arachnidlabs"><i class="fa fa-twitter"></i></a></li>
				<!--<li><a href=""><i class="fa fa-youtube-play"></i></a></li>-->
				<li><a href="https://plus.google.com/+Arachnidlabs/"><i class="fa fa-google-plus"></i></a></li>
			</ul>

		</footer>

		<script type="text/javascript">

		  var _gaq = _gaq || [];
		  _gaq.push(['_setAccount', 'UA-84449-7']);
		  _gaq.push(['_trackPageview']);

		  (function() {
		    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		  })();

		</script>

	</body>
</html>